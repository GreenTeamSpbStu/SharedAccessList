<!DOCTYPE html>
<html>
<head lang="ru">
    <meta charset="UTF-8">
    <title></title>
    <link rel="stylesheet" href="styles/signup.css" media="screen" type="text/css" />
    <script type="text/javascript" src="js/jquery-1.11.0.min.js"></script>
</head>
<body>
    <div class="form">
        <h4>Sign up</h4>
        <hr>
        <form onsubmit="Process(); return false" method="post">
            <p id="email"> E-mail:       <input type="text" required name="email"> <span class="fontawesome-ban-circle" ></span></p>
            <p id="password1"> Password: <input type="password" required name="password1"> <span class="fontawesome-ban-circle" ></span></p>
            <p id="password2"> Password: <input type="password" required name="password2"> <span class="fontawesome-ban-circle" ></span></p>
            <p id="name"> Name:          <input type="text" required name="name"> <span class="fontawesome-ban-circle" ></span></p>
            <p><input type="submit" value="SIGN UP"></p>
        </form>
        <script>

            $(function()
            {
                $('.fontawesome-ban-circle').hide();
            });



            function Process(){
                var pas1 =  document.getElementsByName("password1")[0].value;
                var pas2 =  document.getElementsByName("password2")[0].value;

                var email = document.getElementsByName("email")[0].value;
                var name =  document.getElementsByName("name")[0].value;

                var reMail = /^([\w-]+(?:\.[\w-]+)*)@((?:[\w-]+\.)*\w[\w-]{0,66})\.([a-z]{2,6}(?:\.[a-z]{2})?)$/i;
                var reName = /[А-Яа-яA-Za-z][А-Яа-яA-Za-z _]+/i;

                $('.fontawesome-ban-circle').hide();

                if (pas1 != pas2 || pas1.length < 5) {$('#password2 span').show();  console.log("Invalid Second pass"); return false;}
                if (!reMail.test(email)) {$('#email span').show();      console.log("Invalid email"); return false;}
                if (!reName.test(name) || name.length < 3) {$('#name span').show();       console.log("Invalid name"); return false;}


                $.ajax({
                    type: 'get',
                    url: '/reg.api?mail='+email+'&name='+name+'&passwd='+pass,
                    response: 'text',
                    async: true,
                    tryCount : 0,
                    retryLimit : 3,
                    timeout: 2000,
                    retryAfter:5000,
                    success : function(res)
                    {
                        window.location.href = "index.html";
                    },
                    error: function(res)
                    {
                        console.log(res); this.tryCount++;  if (this.tryCount < this.retryLimit) $.ajax(this);
                    }
                });
                return true;
            }

            function Register(email, name, pass)
            {
                var url = getDomain() + "/reg.api?mail="+email+"&name="+name+"&passwd="+pass;
                xmlHttp = new XMLHttpRequest();
                xmlHttp.open( "GET", url, false );
                xmlHttp.send( null );
                return xmlHttp;
            }


        </script>

    </div>


</body>
</html>